import { DataTypes } from 'sequelize';
import sequelize from '../config/sequelize.js';

// –ú–æ–¥–µ–ª—å –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã
const Quiz = sequelize.define('Quiz', {
  id: {
    type: DataTypes.INTEGER,
    primaryKey: true,
    autoIncrement: true
  },
  title: {
    type: DataTypes.STRING,
    allowNull: false
  },
  description: {
    type: DataTypes.TEXT,
    allowNull: false
  },
  shortDescription: {
    type: DataTypes.TEXT,
    allowNull: true
  },
  category: {
    type: DataTypes.STRING,
    allowNull: false
  },
  image: {
    type: DataTypes.STRING,
    allowNull: false
  },
  difficulty: {
    type: DataTypes.STRING,
    allowNull: true,
    defaultValue: 'medium',
    validate: {
      isIn: [['easy', 'medium', 'hard']]
    }
  },
  minAge: {
    type: DataTypes.INTEGER,
    allowNull: true,
    defaultValue: 8
  },
  estimatedTime: {
    type: DataTypes.INTEGER, // –í—Ä–µ–º—è –≤ –º–∏–Ω—É—Ç–∞—Ö
    allowNull: true
  },
  featured: {
    type: DataTypes.BOOLEAN,
    defaultValue: false
  },
  relatedExhibits: {
    type: DataTypes.TEXT, // –ú–∞—Å—Å–∏–≤ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —ç–∫—Å–ø–æ–Ω–∞—Ç–æ–≤ –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON
    allowNull: true,
    get() {
      const rawValue = this.getDataValue('relatedExhibits');
      return rawValue ? JSON.parse(rawValue) : [];
    },
    set(value) {
      this.setDataValue('relatedExhibits', JSON.stringify(value));
    }
  },
  questions: {
    type: DataTypes.TEXT, // JSON –≤ –≤–∏–¥–µ —Ç–µ–∫—Å—Ç–∞
    allowNull: false,
    get() {
      const rawValue = this.getDataValue('questions');
      return rawValue ? JSON.parse(rawValue) : [];
    },
    set(value) {
      this.setDataValue('questions', JSON.stringify(value));
    }
  }
}, {
  timestamps: true,
  tableName: 'quizzes'
});

// –î–∞–Ω–Ω—ã–µ –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –±–∞–∑—ã –≤–∏–∫—Ç–æ—Ä–∏–Ω–∞–º–∏
const defaultQuizzes = [
  {
    title: "–ò—Å—Ç–æ—Ä–∏—è –≤—ã—á–∏—Å–ª–∏—Ç–µ–ª—å–Ω–æ–π —Ç–µ—Ö–Ω–∏–∫–∏",
    description: "–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–≤–æ–∏ –∑–Ω–∞–Ω–∏—è –æ–± –æ—Å–Ω–æ–≤–Ω—ã—Ö –≤–µ—Ö–∞—Ö —Ä–∞–∑–≤–∏—Ç–∏—è –∫–æ–º–ø—å—é—Ç–µ—Ä–æ–≤ –∏ –≤—ã—á–∏—Å–ª–∏—Ç–µ–ª—å–Ω–æ–π —Ç–µ—Ö–Ω–∏–∫–∏ –≤ —ç—Ç–æ–π —É–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω–æ–π –≤–∏–∫—Ç–æ—Ä–∏–Ω–µ. –í—ã —É–∑–Ω–∞–µ—Ç–µ –æ –ø–µ—Ä–≤–æ–ø—Ä–æ—Ö–æ–¥—Ü–∞—Ö –∫–æ–º–ø—å—é—Ç–µ—Ä–Ω–æ–π –∏–Ω–¥—É—Å—Ç—Ä–∏–∏, —Ä–µ–≤–æ–ª—é—Ü–∏–æ–Ω–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö –∏ –≤–∞–∂–Ω—ã—Ö —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ—Ä—ã–≤–∞—Ö.",
    shortDescription: "–í–∏–∫—Ç–æ—Ä–∏–Ω–∞ –æ –∫–ª—é—á–µ–≤—ã—Ö –º–æ–º–µ–Ω—Ç–∞—Ö –≤ —Ä–∞–∑–≤–∏—Ç–∏–∏ –∫–æ–º–ø—å—é—Ç–µ—Ä–Ω–æ–π —Ç–µ—Ö–Ω–∏–∫–∏",
    category: "–ò—Å—Ç–æ—Ä–∏—è",
    image: "https://images.unsplash.com/photo-1517433367423-c7e5b0f35086?w=500&auto=format&fit=crop",
    difficulty: "medium",
    minAge: 12,
    estimatedTime: 15,
    featured: true,
    relatedExhibits: [1],
    questions: [
      {
        id: 1,
        question: "–ö–∞–∫–æ–π –∫–æ–º–ø—å—é—Ç–µ—Ä —Å—á–∏—Ç–∞–µ—Ç—Å—è –ø–µ—Ä–≤—ã–º –º–∞—Å—Å–æ–≤—ã–º –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–º –∫–æ–º–ø—å—é—Ç–µ—Ä–æ–º —Å –≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º?",
        options: [
          "IBM PC",
          "Apple Macintosh",
          "Commodore 64",
          "ZX Spectrum"
        ],
        correct: 1,
        explanation: "Apple Macintosh, –≤—ã–ø—É—â–µ–Ω–Ω—ã–π –≤ 1984 –≥–æ–¥—É, —Å—Ç–∞–ª –ø–µ—Ä–≤—ã–º –∫–æ–º–º–µ—Ä—á–µ—Å–∫–∏ —É—Å–ø–µ—à–Ω—ã–º –∫–æ–º–ø—å—é—Ç–µ—Ä–æ–º —Å –≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (GUI) –∏ –º—ã—à—å—é."
      },
      {
        id: 2,
        question: "–ö—Ç–æ —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–ª –ø–µ—Ä–≤—ã–π –≤–µ–±-–±—Ä–∞—É–∑–µ—Ä –∏ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä?",
        options: [
          "–°—Ç–∏–≤ –î–∂–æ–±—Å",
          "–ë–∏–ª–ª –ì–µ–π—Ç—Å",
          "–¢–∏–º –ë–µ—Ä–Ω–µ—Ä—Å-–õ–∏",
          "–õ–∏–Ω—É—Å –¢–æ—Ä–≤–∞–ª—å–¥—Å"
        ],
        correct: 2,
        explanation: "–¢–∏–º –ë–µ—Ä–Ω–µ—Ä—Å-–õ–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–ª –ø–µ—Ä–≤—ã–π –≤–µ–±-–±—Ä–∞—É–∑–µ—Ä –∏ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä –≤ 1990 –≥–æ–¥—É, –∑–∞–ª–æ–∂–∏–≤ –æ—Å–Ω–æ–≤—ã —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –ò–Ω—Ç–µ—Ä–Ω–µ—Ç–∞."
      },
      {
        id: 3,
        question: "–ö–∞–∫–æ–π —è–∑—ã–∫ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è –±—ã–ª —Å–æ–∑–¥–∞–Ω –ø–µ—Ä–≤—ã–º?",
        options: [
          "FORTRAN",
          "COBOL",
          "Pascal",
          "C"
        ],
        correct: 0,
        explanation: "FORTRAN (FORmula TRANslation) –±—ã–ª —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω IBM –≤ 1950-—Ö –≥–æ–¥–∞—Ö –∏ —Å—á–∏—Ç–∞–µ—Ç—Å—è –ø–µ—Ä–≤—ã–º –≤—ã—Å–æ–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–º —è–∑—ã–∫–æ–º –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è."
      },
      {
        id: 4,
        question: "–ö–∞–∫–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ ENIAC –∑–∞–Ω–∏–º–∞–ª–æ –≤ 1945 –≥–æ–¥—É?",
        options: [
          "–ù–∞—Å—Ç–æ–ª—å–Ω–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ",
          "–ù–µ—Å–∫–æ–ª—å–∫–æ —à–∫–∞—Ñ–æ–≤",
          "–¶–µ–ª—É—é –∫–æ–º–Ω–∞—Ç—É",
          "–¶–µ–ª–æ–µ –∑–¥–∞–Ω–∏–µ"
        ],
        correct: 2,
        explanation: "ENIAC (Electronic Numerical Integrator and Computer) –∑–∞–Ω–∏–º–∞–ª —Ü–µ–ª—É—é –∫–æ–º–Ω–∞—Ç—É –ø–ª–æ—â–∞–¥—å—é –æ–∫–æ–ª–æ 167 –∫–≤.–º –∏ –≤–µ—Å–∏–ª –æ–∫–æ–ª–æ 30 —Ç–æ–Ω–Ω."
      },
      {
        id: 5,
        question: "–ö–∞–∫–æ–π –æ–±—ä–µ–º –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–π –ø–∞–º—è—Ç–∏ –∏–º–µ–ª –ø–µ—Ä–≤—ã–π Macintosh 1984 –≥–æ–¥–∞?",
        options: [
          "128 –ö–ë",
          "512 –ö–ë",
          "1 –ú–ë",
          "4 –ú–ë"
        ],
        correct: 0,
        explanation: "–ü–µ—Ä–≤—ã–π Macintosh –∏–º–µ–ª 128 –ö–ë –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–π –ø–∞–º—è—Ç–∏, —á—Ç–æ —Å—á–∏—Ç–∞–ª–æ—Å—å –¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–º –¥–ª—è –≥—Ä–∞—Ñ–∏—á–µ—Å–∫–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Ç–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏."
      }
    ]
  },
  {
    title: "–†–µ–≤–æ–ª—é—Ü–∏—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤",
    description: "–£–∑–Ω–∞–π—Ç–µ –±–æ–ª—å—à–µ –æ–± —ç–≤–æ–ª—é—Ü–∏–∏ –º–æ–±–∏–ª—å–Ω—ã—Ö —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤ –∏ —Å–º–∞—Ä—Ç—Ñ–æ–Ω–æ–≤ –≤ —ç—Ç–æ–π –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–π –≤–∏–∫—Ç–æ—Ä–∏–Ω–µ. –û—Ç –ø–µ—Ä–≤—ã—Ö –≥—Ä–æ–º–æ–∑–¥–∫–∏—Ö –º–æ–±–∏–ª—å–Ω—ã—Ö —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤ –¥–æ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–º–∞—Ä—Ç—Ñ–æ–Ω–æ–≤ - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ, –Ω–∞—Å–∫–æ–ª—å–∫–æ —Ö–æ—Ä–æ—à–æ –≤—ã –∑–Ω–∞–µ—Ç–µ –∏—Å—Ç–æ—Ä–∏—é —É—Å—Ç—Ä–æ–π—Å—Ç–≤, –∫–æ—Ç–æ—Ä—ã–º–∏ –ø–æ–ª—å–∑—É–µ–º—Å—è –∫–∞–∂–¥—ã–π –¥–µ–Ω—å.",
    shortDescription: "–¢–µ—Å—Ç –æ —Ä–∞–∑–≤–∏—Ç–∏–∏ –º–æ–±–∏–ª—å–Ω—ã—Ö —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤ –∏ —Å–º–∞—Ä—Ç—Ñ–æ–Ω–æ–≤",
    category: "–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏",
    image: "https://images.unsplash.com/photo-1511707171634-5f897ff02aa9?w=500&auto=format&fit=crop",
    difficulty: "easy",
    minAge: 10,
    estimatedTime: 10,
    featured: true,
    relatedExhibits: [3],
    questions: [
      {
        id: 1,
        question: "–ö–∞–∫–∞—è –∫–æ–º–ø–∞–Ω–∏—è –≤—ã–ø—É—Å—Ç–∏–ª–∞ –ø–µ—Ä–≤—ã–π —Å–º–∞—Ä—Ç—Ñ–æ–Ω —Å —Å–µ–Ω—Å–æ—Ä–Ω—ã–º —ç–∫—Ä–∞–Ω–æ–º?",
        options: [
          "Apple",
          "Nokia",
          "IBM",
          "Samsung"
        ],
        correct: 2,
        explanation: "IBM Simon, –≤—ã–ø—É—â–µ–Ω–Ω—ã–π –≤ 1994 –≥–æ–¥—É, —Å—á–∏—Ç–∞–µ—Ç—Å—è –ø–µ—Ä–≤—ã–º —Å–º–∞—Ä—Ç—Ñ–æ–Ω–æ–º —Å —Å–µ–Ω—Å–æ—Ä–Ω—ã–º —ç–∫—Ä–∞–Ω–æ–º."
      },
      {
        id: 2,
        question: "–í –∫–∞–∫–æ–º –≥–æ–¥—É –±—ã–ª –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω –ø–µ—Ä–≤—ã–π iPhone?",
        options: [
          "2005",
          "2007",
          "2009",
          "2010"
        ],
        correct: 1,
        explanation: "–ü–µ—Ä–≤—ã–π iPhone –±—ã–ª –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω –°—Ç–∏–≤–æ–º –î–∂–æ–±—Å–æ–º 9 —è–Ω–≤–∞—Ä—è 2007 –≥–æ–¥–∞ –Ω–∞ –∫–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü–∏–∏ Macworld."
      },
      {
        id: 3,
        question: "–ö–∞–∫–∞—è –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–º–∞—Ä—Ç—Ñ–æ–Ω–æ–≤?",
        options: [
          "iOS",
          "Android",
          "Windows Mobile",
          "BlackBerry OS"
        ],
        correct: 1,
        explanation: "Android –æ—Ç Google —è–≤–ª—è–µ—Ç—Å—è –Ω–∞–∏–±–æ–ª–µ–µ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–Ω–æ–π –º–æ–±–∏–ª—å–Ω–æ–π –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º–æ–π –≤ –º–∏—Ä–µ, —Å –¥–æ–ª–µ–π —Ä—ã–Ω–∫–∞ –±–æ–ª–µ–µ 70%."
      },
      {
        id: 4,
        question: "–ö–∞–∫–∞—è –º–æ–¥–µ–ª—å Nokia —Å—Ç–∞–ª–∞ –∏–∑–≤–µ—Å—Ç–Ω–∞ —Å–≤–æ–µ–π –Ω–µ–≤–µ—Ä–æ—è—Ç–Ω–æ–π –ø—Ä–æ—á–Ω–æ—Å—Ç—å—é –∏ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å—é?",
        options: [
          "Nokia 3310",
          "Nokia 5110",
          "Nokia 6600",
          "Nokia N95"
        ],
        correct: 0,
        explanation: "Nokia 3310, –≤—ã–ø—É—â–µ–Ω–Ω–∞—è –≤ 2000 –≥–æ–¥—É, —Å—Ç–∞–ª–∞ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–µ–º–æ–º –±–ª–∞–≥–æ–¥–∞—Ä—è —Å–≤–æ–µ–π –ª–µ–≥–µ–Ω–¥–∞—Ä–Ω–æ–π –ø—Ä–æ—á–Ω–æ—Å—Ç–∏ –∏ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏."
      },
      {
        id: 5,
        question: "–ß—Ç–æ –∏–∑ –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–Ω–æ–≥–æ –ù–ï —è–≤–ª—è–µ—Ç—Å—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–º —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ —Å–º–∞—Ä—Ç—Ñ–æ–Ω–∞?",
        options: [
          "–ì–∏—Ä–æ—Å–∫–æ–ø",
          "NFC-—á–∏–ø",
          "–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ-–ª—É—á–µ–≤–∞—è —Ç—Ä—É–±–∫–∞",
          "–ê–∫—Å–µ–ª–µ—Ä–æ–º–µ—Ç—Ä"
        ],
        correct: 2,
        explanation: "–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ-–ª—É—á–µ–≤–∞—è —Ç—Ä—É–±–∫–∞ (–≠–õ–¢) –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞—Å—å –≤ —Å—Ç–∞—Ä—ã—Ö —Ç–µ–ª–µ–≤–∏–∑–æ—Ä–∞—Ö –∏ –º–æ–Ω–∏—Ç–æ—Ä–∞—Ö, –Ω–æ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –ø—Ä–∏–º–µ–Ω—è–ª–∞—Å—å –≤ —Å–º–∞—Ä—Ç—Ñ–æ–Ω–∞—Ö –∏–∑-–∑–∞ —Å–≤–æ–∏—Ö —Ä–∞–∑–º–µ—Ä–æ–≤ –∏ —ç–Ω–µ—Ä–≥–æ–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è."
      }
    ]
  }
];

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –≤–∏–∫—Ç–æ—Ä–∏–Ω–∞–º–∏
const seedQuizzes = async (force = false) => {
  try {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É–∂–µ –¥–∞–Ω–Ω—ã–µ –≤ —Ç–∞–±–ª–∏—Ü–µ
    const count = await Quiz.count();
    
    // –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç –∏–ª–∏ —É–∫–∞–∑–∞–Ω —Ñ–ª–∞–≥ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–≥–æ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è
    if (count === 0 || force) {
      console.log('üì• –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö –≤–∏–∫—Ç–æ—Ä–∏–Ω –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö...');
      
      // –°–æ–∑–¥–∞–µ–º –∑–∞–ø–∏—Å–∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ
      for (const item of defaultQuizzes) {
        await Quiz.create(item);
      }
      
      console.log(`‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ ${defaultQuizzes.length} —Ç–µ—Å—Ç–æ–≤—ã—Ö –≤–∏–∫—Ç–æ—Ä–∏–Ω`);
    } else {
      console.log(`‚ÑπÔ∏è –í –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö —É–∂–µ –µ—Å—Ç—å ${count} –≤–∏–∫—Ç–æ—Ä–∏–Ω. –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö.`);
    }
  } catch (error) {
    console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —Ç–µ—Å—Ç–æ–≤—ã—Ö –≤–∏–∫—Ç–æ—Ä–∏–Ω:', error);
  }
};

export { Quiz, seedQuizzes }; 